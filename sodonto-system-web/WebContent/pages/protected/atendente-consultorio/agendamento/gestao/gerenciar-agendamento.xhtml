<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui">

<ui:composition template="/WEB-INF/template/template.xhtml">
	<ui:define name="content">
		<h:form>
		
			<p:defaultCommand target="bt_ir_pages"/>
					
			<p:growl id="messages" sticky="true"/>
			<p:toolbar>
			<p:toolbarGroup align="left">
				<p:commandButton title="Home" icon="ui-icon-home" action="index-protected" immediate="true"></p:commandButton>
				<p:separator></p:separator>
				<h:outputText value="Home | Agenda | Agendamento | Gerenciar Agendamento" style="font-size: 10px" />
			</p:toolbarGroup>
			
				<p:toolbarGroup id="tb_pages" rendered="#{pagesMB.keyValidation.active}"  align="right">
					<p:separator/>
					<p:spacer width="5"/>
					
					<h:outputText value="Smart Menu: "
					title="Smart Menu: Menu Inteligente para busca rápida de Páginas do Sistema"
					style="cursor: help;"/>
					<p:autoComplete
					title="Digite no mínimo 03 caracteres da PÁGINA que deseja acessar, para que o SMART MENU, filtre todos os Componentes relacionados com a sua busca, de forma rápida e eficiente." 
					value="#{pagesMB.pageSelected}"
					completeMethod="#{pagesMB.allPages}"
					var="page"
					itemLabel="#{page.nome}"
					itemValue="#{page}" 
					size="40"
					maxResults="5"
					minQueryLength="3"
					forceSelection="true">
						<p:ajax event="itemSelect" update="bt_ir_pages"/>
						<p:ajax event="keyup" update="bt_ir_pages"/>
					</p:autoComplete>
					<p:spacer width="5"/>

					<p:commandButton id="bt_ir_pages" title="Ir para Página" 
					disabled="#{pagesMB.pageSelected == null}"
					icon="ui-icon-circle-triangle-e" 
					action="#{pagesMB.irParaPagina()}"
					widgetVar="bt_smart_menu_wv" onclick="bt_smart_menu_wv.disable()"/>

				</p:toolbarGroup>			
			</p:toolbar>
			<br />	
			<p:panel header="GERENCIAR AGENDAMENTO">	
			<p>Preencha corretamente as informações para Cadastrar Agendamentos</p>
			<br />
			<h:panelGrid id="panel_agendamento" columns="1" cellpadding="5" width="100%">
				<p:fieldset legend="Filtro de Busca" toggleable="true"
				rendered="#{agendamentoMB.dentistaAgendaSelecionadoDTO.idDentistaAgenda == null}">
					<h:panelGrid columns="2">
					
						<h:outputLabel for="agenda_dentista_estabelecimento" value="Estabelecimento: " />							
						<h:selectOneMenu id="agenda_dentista_estabelecimento"
							value="#{dentistaAgendaMB.estabelecimentoFiltroDTO}"
							converter="estabelecimentoConverter"
							disabled="#{pagesMB.permissaoGestor ? 'false' : 'true'}">								

							<f:selectItem itemLabel="Escolha uma opção"
								noSelectionOption="true" />

							<f:selectItems value="#{estabelecimentoMB.estabelecimentos}" 
								var="estabelecimento" itemLabel="#{estabelecimento.nomeEstabelecimentoFormatado}" 
								itemValue="#{estabelecimento}">
							</f:selectItems>
								
							<p:ajax event="valueChange" update=":#{p:component('panel_agendamento')}"></p:ajax>

						</h:selectOneMenu>					
						
						<h:outputText value="Data: " />
						<p:calendar locale="pt" value="#{dentistaAgendaMB.dataFiltro}"
						mindate="#{pagesMB.permissaoGestor ? '' : pagesMB.dataAtual}" pattern="dd/MM/yyyy">
							<p:ajax event="dateSelect" update=":#{p:component('panel_agendamento')}" listener="#{agendamentoMB.selecionarData(dentistaAgendaMB.dataFiltro)}"/>
							<p:ajax event="valueChange" update=":#{p:component('panel_agendamento')}" listener="#{agendamentoMB.selecionarData(dentistaAgendaMB.dataFiltro)}"/>
						</p:calendar>
						
						<h:outputText value="Bloquear o dia:" title="Bloqueia todas as agendas do dia, impedindo que novas operações sejam realizadas no dia selecionado. Tal bloqueio serve para ativar o botão para ENCERRAMENTO DO DIA." style="cursor: help;"
						rendered="#{pagesMB.permissaoGestor and dentistaAgendaMB.dataFiltro != null and pagesMB.igualDataAtual(agendamentoMB.dataSelecionada)}"/>
						<p:selectOneRadio  value="#{agendamentoMB.diaBloqueado}"
						rendered="#{pagesMB.permissaoGestor and dentistaAgendaMB.dataFiltro != null and pagesMB.igualDataAtual(agendamentoMB.dataSelecionada)}"
						disabled="#{agendamentoMB.diaEncerrado}">
							<f:selectItem itemLabel="Sim" itemValue="true"/>
							<f:selectItem itemLabel="Não" itemValue="false"/>
								<p:ajax update=":#{p:component('panel_agendamento')}"/>
						</p:selectOneRadio>											
					</h:panelGrid>
					<br />
					<p:dataTable id="tabela_dentista_agenda"
					rendered="#{dentistaAgendaMB.dataFiltro != null and dentistaAgendaMB.estabelecimentoFiltroDTO.idEstabelecimento != null}"
					value="#{dentistaAgendaMB.dentistaAgendasFiltrados}" var="agenda"
					paginator="#{dentistaAgendaMB.dentistaAgendasFiltrados.size() > pagesMB.atributoOperacionalSelecionado.numeroLinhaTabela ? 'true' : 'false'}" rows="#{pagesMB.atributoOperacionalSelecionado.numeroLinhaTabela}"
					paginatorPosition="bottom"
					emptyMessage="Nenhum dado encontrado...">
						<f:facet name="header">
								<h:outputText value="TABELA DE AGENDAS DE DENTISTAS PARA O DIA: "/>
								<h:outputText value="#{dentistaAgendaMB.dataFiltro}">
									<f:convertDateTime pattern="dd/MM/yyyy"/>
								</h:outputText>	
								
								<p:spacer width="10"/>
								
								<p:commandButton icon="ui-icon-star" 
								action="#{agendamentoMB.encerrarDia()}"
								title="Realizar Rotina de Fechamento do dia. Essa rotina após realizada não terá retorno." 
								rendered="#{agendamentoMB.diaBloqueado and pagesMB.igualDataAtual(dentistaAgendaMB.dataFiltro)}"
								update=":#{p:component('messages')}"
								widgetVar="bt_fechar_dia_wv"
								onclick="bt_fechar_dia_wv.disable()">
									<p:confirm header="Fechamento do Dia" icon="ui-icon-alert" message="Deseja realmente ENCERRAR O DIA? (Lembre-se: Ao executar essa rotina, não haverá retorno.)"/>
									<f:actionListener binding="#{atendimentoMB.encerrarDia()}"/>
								</p:commandButton>
						</f:facet>
						
						<p:column width="5%">
							<f:facet name="header">Ordem</f:facet>
							#{dentistaAgendaMB.dentistaAgendasFiltrados.indexOf(agenda) + 1}
						</p:column>

						<p:column width="10%" style="text-align: center">
							<f:facet name="header">ID</f:facet>
							#{agenda.idDentistaAgenda}
						</p:column>	

						<p:column width="10%" style="text-align: center">
							<f:facet name="header">CRO</f:facet>
							#{agenda.dentista.croFormatado}
						</p:column>	
							
						<p:column width="20%" style="text-align: center">
							<f:facet name="header">Dentista</f:facet>
							#{agenda.dentista.nomeCompleto}
						</p:column>															
							
						<p:column width="15%">
							<f:facet name="header">Data</f:facet>
							<h:outputText value="#{agenda.dataAgenda}">
								<f:convertDateTime pattern="dd/MM/yyyy"/>
							</h:outputText>
						</p:column>	
							
						<p:column width="50%" style="text-align: center">
							<f:facet name="header">Intervalo Horário</f:facet>
							#{agenda.intervaloTempo}
						</p:column>	
						
						<p:column width="10%" style="text-align: center">
							<p:commandButton action="#{agendamentoMB.selecionarDentistaAgenda(agenda)}" 
							icon="ui-icon-flag"
							title="Selecionar Agenda de Dentista"
							update=":#{p:component('messages')}, 
							:#{p:component('panel_agendamento')}"
							widgetVar="bt_selecionar_agenda_wv_#{agenda.idDentistaAgenda}"
							onclick="bt_selecionar_agenda_wv_#{agenda.idDentistaAgenda}.disable()">
								<f:actionListener binding="#{dentistaAgendaMB.limparMB()}"/>
								<f:actionListener binding="#{estabelecimentoMB.limparMB()}"/>
							</p:commandButton>								
						</p:column>	
																	
					</p:dataTable>					
				</p:fieldset>
				
				<p:fieldset legend="Dados da Agenda de Dentista Selecionada"
				rendered="#{agendamentoMB.dentistaAgendaSelecionadoDTO.idDentistaAgenda != null}">
					<h:panelGrid id="pn_agenda_selecionada" columns="2" cellpadding="5">
						<h:outputText value="Data da Agenda: " />
						<h:outputText value="#{agendamentoMB.dentistaAgendaSelecionadoDTO.dataAgenda}">
							<f:convertDateTime pattern="dd/MM/yyyy"/>
						</h:outputText>
						<h:outputText value="Horário da Agenda: " />
						<h:outputText value="#{agendamentoMB.dentistaAgendaSelecionadoDTO.intervaloTempo}" />						
						<h:outputText value="Nome do Dentista: " />
						<h:outputText value="#{agendamentoMB.dentistaAgendaSelecionadoDTO.dentista.nomeCompleto}" />
						<h:outputText value="CRO: " />
						<h:outputText value="#{agendamentoMB.dentistaAgendaSelecionadoDTO.dentista.croFormatado}" />
						<h:outputText value="Limite de Agendamentos: " />
						<h:outputText value="#{agendamentoMB.limiteAtendimentos}" />
						<h:outputText value="Vagas Disponíveis: " />
						<h:outputText value="#{agendamentoMB.totalAtendimentos}" />
						<h:outputText value="Situação do Dia: " />
						<h:outputText value="#{agendamentoMB.diaBloqueado and agendamentoMB.diaEncerrado == false ? 'BLOQUEADO' : (agendamentoMB.diaBloqueado and agendamentoMB.diaEncerrado ? 'ENCERRADO' : 'ABERTO')}" />																			
						<p:commandButton icon="ui-icon-closethick" title="Remover seleção da Agenda do Dentista" 
						action="#{agendamentoMB.removerSelecaoDentistaAgenda()}" update=":#{p:component('panel_agendamento')}"/>
					</h:panelGrid>
				</p:fieldset>
				
				<p:fieldset legend="Seleção de Paciente" toggleable="true"
				rendered="#{agendamentoMB.dentistaAgendaSelecionadoDTO.idDentistaAgenda != null and agendamentoMB.diaBloqueado == false and pagesMB.permissaoAtendente}">

					<p:fieldset legend="Filtro de Busca" toggleable="true">					
								<h:panelGrid columns="1" cellspacing="10">					
									<h:panelGrid id="filtro_paciente_busca_pn" columns="2">
										<p:outputLabel for="filtro_paciente_busca"
											value="Dados para busca: " />
										<h:panelGrid columns="2">
											<p:inputText id="filtro_paciente_busca"
												value="#{pacienteMB.campoInteligenteBusca}"
												size="80"
												title="O Sistema inteligente de busca detecta se a busca será por ID, CPF, RG ou Nome. No entanto, deve-se seguir um padrão de busca conforme o exemplo a seguir: # Para buscas pelo ID deve-se digitar apenas números. Para buscas pelo CPF devese digitar os três primeiros dígitos do CPF e em seguida um ponto (123.). # Para buscas pelo RG deve-se digitar o primeiro dígito do RG e em seguida um ponto (1.). # Para buscas pelo Nome deve-se digitar qualquer parte do Nome ou Sobrenome."
												maxlength="100">
												<p:ajax event="keyup"
													update=":#{p:component('tabela_paciente_pn')}"></p:ajax>
											</p:inputText>
											<p:watermark for="filtro_paciente_busca"
												value="Digite parte do Código, CPF (Ex.: 123.), RG (Ex.: 1.) ou do Nome...">
											</p:watermark>
										</h:panelGrid>
									</h:panelGrid>
								</h:panelGrid>
						</p:fieldset>
						<br />				
					
					<h:panelGrid id="tabela_paciente_pn" columns="1" width="100%">
					<p:dataTable id="tabela_paciente"
							value="#{pacienteMB.buscaInteligente()}" var="paciente"
							paginator="#{pacienteMB.buscaInteligente().size() > pagesMB.atributoOperacionalSelecionado.numeroLinhaTabela ? 'true' : 'false'}" rows="#{pagesMB.atributoOperacionalSelecionado.numeroLinhaTabela}"
							emptyMessage="Nenhum dado encontrado..."
							paginatorPosition="bottom"
							rendered="#{pacienteMB.campoInteligenteBusca.equals('') ? 'false' : 'true'}">
		
							<f:facet name="header">
					TABELA DE PACIENTES
					</f:facet>
							<p:column width="5%" style="text-align: center">
								<f:facet name="header"></f:facet>
									<p:commandButton action="#{obsPacienteMB.selecionarPaciente(paciente, 'C')}" 
									icon="ui-icon-alert"
									title="Visualizar Observações do Paciente: #{paciente.nomeCompleto}"
									oncomplete="dialog_obs_paciente_wv.show()"
									update=":#{p:component('messages')}, 
									:#{p:component('dialog_obs_paciente')}"/>	
							</p:column>	
												
							<p:column width="5%" style="text-align: center">
								<f:facet name="header">Código</f:facet>
									#{paciente.idPaciente}
								</p:column>	
														
							<p:column width="10%" style="text-align: center">
									<f:facet name="header">Nome</f:facet>
								<p:commandLink value="#{paciente.nomeCompleto}" 
								rendered="#{pacienteMB.isTelefoneAtualizado(paciente) ? 'false' : 'true'}"
								style="color: #F00; font-weight:bold; cursor:pointer;
								text-decoration: none;"
								oncomplete ="dialog_paciente_atualizacao_wv.show()"
								action="#{pacienteMB.alterarPaciente(paciente)}"
								update=":#{p:component('dialog_paciente_atualizacao')}"	
								title="Paciente com dados de Comunicação desatualizados, favor confirmar, com o mesmo, se o Telefone e o Celular são os mesmos.">
								</p:commandLink>
								
								<h:outputText value="#{paciente.nomeCompleto}" 
								rendered="#{pacienteMB.isTelefoneAtualizado(paciente)}" 
								style="cursor: help" title="DENTISTA: #{paciente.dentistaDTO.nomeComCROFormatado}"/> 						 
								</p:column>
										<p:column width="5%" style="text-align: center">
											<f:facet name="header">Tipo</f:facet>
									#{paciente.contratante ? 'TITULAR' : 'DEPENDENTE'}
								</p:column>							
										<p:column width="5%" style="text-align: center">
											<f:facet name="header">CPF</f:facet>
											<h:outputText value="(NÃO POSSUI)" 
											rendered="#{(paciente.cpf == '000.000.000-00' or paciente.cpf == null) and !paciente.contratante}" 
											title="Paciente dependente, o CPF não é obrigatório."
											style="cursor: help"/> 
											
											<h:outputText value="#{paciente.cpf}" 
											rendered="#{(paciente.cpf != '000.000.000-00' or paciente.cpf != null) and !paciente.contratante}"/>
											
											<h:outputText value="#{paciente.cpf}" 
											rendered="#{paciente.cpf == '000.000.000-00' and paciente.contratante}" 
											title="Paciente com CPF inválido, lembre-se de ATUALIZÁ-LO!"
											style="cursor: help; color:#FF8C00; font-weight: bold"/> 	
											
											<h:outputText value="#{paciente.cpf}" 
											rendered="#{paciente.cpf != '000.000.000-00' and paciente.contratante}"/> 
								</p:column>			
								
										<p:column width="5%" style="text-align: center">
											<f:facet name="header">Estabelecimento</f:facet>
									#{paciente.estabelecimentoDTO.nomeEstabelecimentoFormatado}
								</p:column>
					
										<p:column rendered="#{pagesMB.permissaoAtendente}">
											<f:facet name="header">Telefone</f:facet>
									#{paciente.telResidencial}
								</p:column>
								
										<p:column rendered="#{pagesMB.permissaoAtendente}">
											<f:facet name="header">Operadora</f:facet>
									(#{paciente.operadoraCel01.nomeOperadora}) 
								</p:column>						
								
										<p:column rendered="#{pagesMB.permissaoAtendente}">
											<f:facet name="header">Celular</f:facet>
									 #{paciente.cel01}
								</p:column>		
							<p:column width="10%" style="text-align: center">
								<p:commandButton value="Incluir"
									icon="ui-icon-plusthick"
									rendered="#{paciente.dentistaDTO.idDentista == agendamentoMB.dentistaAgendaSelecionadoDTO.dentista.idDentista and paciente.ativo}"
									disabled="#{pacienteMB.isTelefoneAtualizado(paciente) == false}"
									action="#{agendamentoMB.incluirAgendamentoPaciente(paciente)}"
									update=":#{p:component('panel_agendamento')},
									:#{p:component('messages')}"
									widgetVar="bt_incluir_paciente_a_wv_#{paciente.idPaciente}"
									onclick="bt_incluir_paciente_a_wv_#{paciente.idPaciente}.disable()">
								</p:commandButton>							
							
								<p:commandButton value="Incluir"
									style="color: red;"
									title="Paciente vinculado a outro Dentista: #{paciente.dentistaDTO.nomeComCROFormatado}"
									rendered="#{paciente.dentistaDTO.idDentista != agendamentoMB.dentistaAgendaSelecionadoDTO.dentista.idDentista and paciente.ativo}"
									icon="ui-icon-plusthick"
									disabled="#{pacienteMB.isTelefoneAtualizado(paciente) == false}"
									action="#{agendamentoMB.incluirAgendamentoPaciente(paciente)}"
									update=":#{p:component('panel_agendamento')},
									:#{p:component('messages')}"
									widgetVar="bt_incluir_paciente_b_wv_#{paciente.idPaciente}"
									onclick="bt_incluir_paciente_b_wv_#{paciente.idPaciente}.disable()">									
										<p:confirm icon="ui-icon-alert" header="Confirmação de Agendamento" message="O Paciente selecionado está vinculado a OUTRO DENTISTA, deseja agendá-lo mesmo assim?"/>																					
								</p:commandButton>
															
							</p:column>				
							<f:facet name="footer">
							Total: 
							#{pacienteMB.buscaInteligente().size()}
							</f:facet>
						</p:dataTable>
						</h:panelGrid>

				</p:fieldset>
				
				<p:poll update="pn_tb_agendamento, pn_agenda_selecionada" interval="#{pagesMB.agendamentoTimePoll}" rendered="#{agendamentoMB.dentistaAgendaSelecionadoDTO.idDentistaAgenda != null}"/>
					
				<p:fieldset legend="Listagem de Agendamentos"
				rendered="#{agendamentoMB.dentistaAgendaSelecionadoDTO.idDentistaAgenda != null}">	
				
					<p:fieldset legend="Filtros de Busca de Agendamentos"
					rendered="#{agendamentoMB.dentistaAgendaSelecionadoDTO.idDentistaAgenda != null}">	
						<h:panelGrid id="panel_filtro_agendamento" columns="5">
							<p:outputLabel for="situacao_agendamento_filtro" value="Situação: " />
							<h:selectOneMenu id="situacao_agendamento_filtro"
								value="#{agendamentoMB.situacaoFiltro}">

								<f:selectItem itemLabel="TODAS AS SITUAÇÕES..."
									noSelectionOption="true" />

								<f:selectItems value="#{agendamentoMB.situacoesAgendamento}" var="situacao"
									itemLabel="#{situacao.situacao}" itemValue="#{situacao}">
								</f:selectItems>

								<p:ajax event="valueChange" update=":#{p:component('pn_tb_agendamento')}, :#{p:component('panel_filtro_agendamento')}"></p:ajax>

							</h:selectOneMenu>							
							
							<p:spacer width="30"/>
							
							<p:outputLabel for="nome_paciente_busca"
								value="Nome/Sobrenome do Paciente: " />
							<h:panelGrid columns="2">
								<p:inputText id="nome_paciente_busca"
									value="#{agendamentoMB.pacienteNomeFiltro}"
									size="60"
									maxlength="100">
									<p:ajax event="keyup"
										update=":#{p:component('pn_tb_agendamento')}"></p:ajax>
								</p:inputText>
								<p:watermark for="nome_paciente_busca"
									value="Digite parte do NOME ou SOBRENOME do Paciente...">
								</p:watermark>
							</h:panelGrid>
						</h:panelGrid>
					</p:fieldset>				
								
					<h:panelGrid id="pn_tb_agendamento" width="100%">
						<p:dataTable id="tabela_agenda_dentista"
						rendered="#{agendamentoMB.dentistaAgendaSelecionadoDTO.idDentistaAgenda != null}"
						value="#{agendamentoMB.agendamentosFiltrados}" var="agendamento"
						paginator="#{agendamentoMB.agendamentosFiltrados.size() > pagesMB.atributoOperacionalSelecionado.numeroLinhaTabela ? 'true' : 'false'}" rows="#{pagesMB.atributoOperacionalSelecionado.numeroLinhaTabela}"
						emptyMessage="Nenhum dado encontrado..." paginatorPosition="bottom">

							<f:facet name="header">
								<h:outputText value="TABELA DE AGENDAMENTOS / ATENDIMENTOS - DENTISTA: #{agendamentoMB.dentistaAgendaSelecionadoDTO.dentista.nomeComCROFormatado}  | "/>
								
								<p:spacer width="10"/>
									
								<p:commandButton icon="ui-icon-refresh" 
								style="border-color: #BDBDBD"
								update=":#{p:component('panel_agendamento')}"
								title="Atualizar DADOS da Tabela"/>
							</f:facet>
							<p:column width="5%" style="text-align: center">
								<f:facet name="header">Ordem</f:facet>
								#{agendamentoMB.agendamentosFiltrados.indexOf(agendamento) + 1}
							</p:column>
							
							<p:column width="5%" style="text-align: center">
								<f:facet name="header"></f:facet>
								<p:commandButton action="#{obsPacienteMB.selecionarPaciente(agendamento.paciente, 'G')}" 
								icon="ui-icon-alert"
								title="Visualizar Observações do Paciente: #{agendamento.paciente.nomeCompleto}"
								oncomplete="dialog_obs_paciente_wv.show()"
								update=":#{p:component('messages')}, 
								:#{p:component('dialog_obs_paciente')}"/>	
							</p:column>							
							
							<p:column width="5%" style="text-align: center">
								<f:facet name="header">Código Paciente</f:facet>
									<h:outputText rendered="#{agendamento.paciente.dentistaDTO.idDentista == agendamento.dentistaAgenda.dentista.idDentista}" value="#{agendamento.paciente.idPaciente}" />
									<h:outputText rendered="#{agendamento.paciente.dentistaDTO.idDentista != agendamento.dentistaAgenda.dentista.idDentista}" value="#{agendamento.paciente.idPaciente}" 
									style="cursor: help; color: red; font-weight:bold" 
									title="Paciente vinculado ao Dentista: #{agendamento.paciente.dentistaDTO.nomeComCROFormatado}"/>
							</p:column>		
							
							<p:column width="20%" style="text-align: center">
								<f:facet name="header">Nome Paciente</f:facet>
								<h:outputText value="#{agendamento.paciente.nomeCompleto}"
								style="cursor:help"
								rendered="#{pagesMB.permissaoAtendente}"
								title=" Telefone: #{agendamento.paciente.telResidencial}/ Celular: #{agendamento.paciente.cel01}"/>
								
								<h:outputText value="#{agendamento.paciente.nomeCompleto}"
								rendered="#{pagesMB.funcionarioLogado.usuarioPerfil.perfilAtivo == 'C'}"/> 								 
							</p:column>																													
							
							<p:column width="10%" style="text-align: center">
								<f:facet name="header">Data</f:facet>
								<h:outputText value="#{agendamento.dentistaAgenda.dataAgenda}"
								title="Agendamento para o Dentista: #{agendamento.dentistaAgenda.dentista.nomeComCROFormatado} - No Horário: #{agendamento.dentistaAgenda.intervaloTempo}"
								style="cursor: help; font-weight: bold; color: #00F;">
									<f:convertDateTime pattern="dd/MM/yyyy"/>
								</h:outputText>
							</p:column>	
							
							
							<p:column width="20%" style="text-align: center">
								<f:facet name="header">Situação Agendamento</f:facet>
								#{agendamento.situacao.situacao}
							</p:column>	
							
							<p:column width="20%" style="text-align: center">
								<f:facet name="header">Situação Atendimento</f:facet>
								#{atendimentoMB.buscarPorAgendamento(agendamento).idAtendimento == null ? 'NÃO INICIADO' : atendimentoMB.buscarPorAgendamento(agendamento).situacao.situacao}
							</p:column>															
							
							<p:column style="padding-left: 2px; padding-right: 2px;text-align: center;" width="20%">
							<p:commandButton action="#{agendamentoMB.selecionarPaciente(agendamento.paciente)}" 
							icon="ui-icon-arrowthick-1-e"
							title="Enviar Paciente para o Caixa"
							oncomplete="dialog_remarcacao_paciente_wv.show()"
							update=":#{p:component('messages')}, 
							:#{p:component('panel_agendamento')}
							:#{p:component('dialog_remarcacao_paciente')}"
							rendered="#{pagesMB.permissaoAtendente and agendamento.situacao == 'E' and pagesMB.igualDataAtual(agendamento.dentistaAgenda.dataAgenda) and agendamentoMB.diaBloqueado == false}"
							widgetVar="bt_pre_pagamento_wv_#{agendamento.idAgendamento}"
							onclick="bt_pre_pagamento_wv_#{agendamento.idAgendamento}.disable()">
								<f:actionListener binding="#{agendamentoMB.enviarParaPagamento(agendamento)}"/>
								<f:setPropertyActionListener target="#{agendamentoMB.reagendamento}" value="true"/>
							</p:commandButton>								
							
							<p:spacer width="5" rendered="#{agendamento.situacao == 'E'}"/>
							
							<p:commandButton 
							icon="ui-icon-cancel"
							title="Cancelar Agendamento"
							update=":#{p:component('messages')}, 
							:#{p:component('panel_agendamento')},
							:#{p:component('dialog_cancelar_agendamento')}"
							oncomplete="dialog_cancelar_agendamento_wv.show()"
							rendered="#{(pagesMB.permissaoAtendente and agendamento.situacao == 'E' or agendamento.situacao == 'R')  and agendamentoMB.diaBloqueado == false}"
							widgetVar="bt_cancelar_agendamento_wv_#{agendamento.idAgendamento}"
							onclick="bt_cancelar_agendamento_wv_#{agendamento.idAgendamento}.disable()">
								<f:setPropertyActionListener target="#{agendamentoMB.agendamentoDTO}" value="#{agendamento}"/>
							</p:commandButton>								
							
							<p:spacer width="5" rendered="#{agendamento.situacao == 'E' or agendamento.situacao == 'R'}"/>
							
							<p:commandButton action="#{agendamentoMB.reativarAgendamento(agendamento)}" 
							icon="ui-icon-arrowreturn-1-e"
							title="Reativar Agendamento"
							update=":#{p:component('messages')}, 
							:#{p:component('panel_agendamento')}"
							rendered="#{pagesMB.permissaoGestor and agendamento.situacao == 'C' and agendamentoMB.diaBloqueado == false}"
							widgetVar="bt_reativar_agendamento_wv_#{agendamento.idAgendamento}"
							onclick="bt_reativar_agendamento_wv_#{agendamento.idAgendamento}.disable()">
								<p:confirm header="Reativar Agendamento" icon="ui-icon-alert" message="Deseja realmente REATIVAR o Agendamento Cancelado?"/>
							</p:commandButton>	
							
							<p:spacer width="5"
							rendered="#{agendamento.situacao == 'C'}"/>								
							
							<p:commandButton action="#{agendamentoMB.confirmarPagamento(agendamento)}" 
							icon="ui-icon-check"
							title="Confirmar Pagamento"
							update=":#{p:component('messages')}, 
							:#{p:component('panel_agendamento')}"
							rendered="#{pagesMB.permissaoAtendenteConsultorio and agendamento.situacao == 'P' and agendamentoMB.diaBloqueado == false and pagesMB.igualDataAtual(agendamento.dentistaAgenda.dataAgenda)}"
							widgetVar="bt_confirmar_pagamento_wv_#{agendamento.idAgendamento}"
							onclick="bt_confirmar_pagamento_wv_#{agendamento.idAgendamento}.disable()">
								<p:confirm header="Confirmar Pagamento" icon="ui-icon-alert" message="Você CONFIRMA o Pagamento da mesalidade do Paciente?"/>
							</p:commandButton>	
							
							<p:spacer width="5" rendered="#{agendamento.situacao == 'P'}"/>							
							
							<p:commandButton action="#{atendimentoMB.iniciarAtendimento(agendamento)}" 
							icon="ui-icon-clipboard"
							title="Iniciar Atendimento"
							update=":#{p:component('messages')}, 
							:#{p:component('panel_agendamento')}"
							rendered="#{pagesMB.permissaoAtendenteConsultorio and agendamento.situacao == 'N' and agendamentoMB.diaBloqueado == false and pagesMB.igualDataAtual(agendamento.dentistaAgenda.dataAgenda)}"
							widgetVar="bt_iniciar_atendimento_wv_#{agendamento.idAgendamento}"
							onclick="bt_iniciar_atendimento_wv_#{agendamento.idAgendamento}.disable()">
								<p:confirm header="Iniciar Atendimento" icon="ui-icon-alert" message="Deseja realmente INICIAR o Atendimento do Paciente?"/>
							</p:commandButton>	
							
							<p:spacer width="5" rendered="#{agendamento.situacao == 'N'}"/>							
							
							<p:commandButton action="#{atendimentoMB.finalizarAtendimento(atendimentoMB.buscarPorAgendamento(agendamento))}" 
							icon="ui-icon-flag"
							title="Finalizar Atendimento"
							update=":#{p:component('messages')}, 
							:#{p:component('panel_agendamento')}"
							rendered="#{pagesMB.permissaoAtendenteConsultorio and agendamento.situacao == 'T' and agendamentoMB.diaBloqueado == false and pagesMB.igualDataAtual(agendamento.dentistaAgenda.dataAgenda)}"
							widgetVar="bt_finalizar_atendimento_wv_#{agendamento.idAgendamento}"
							onclick="bt_finalizar_atendimento_wv_#{agendamento.idAgendamento}.disable()">
								<p:confirm header="Finalizar Atendimento" icon="ui-icon-alert" message="Deseja realmente FINALIZAR o Atendimento?"/>
							</p:commandButton>	
							
							<p:spacer width="5" rendered="#{agendamento.situacao == 'T'}"/>
							
							<!-- 2.2.00 -->
							
							<p:commandButton action="#{atendimentoMB.incluirAtendimentoFaltoso(agendamento)}" 
							icon="ui-icon-flag"
							title="Incluir Atendimento para Paciente com estado FALTOSO"
							update=":#{p:component('messages')}, 
							:#{p:component('panel_agendamento')}"
							rendered="#{pagesMB.permissaoGestor and agendamento.situacao == 'F'}"
							widgetVar="bt_finalizar_atendimento_wv_#{agendamento.idAgendamento}"
							onclick="bt_finalizar_atendimento_wv_#{agendamento.idAgendamento}.disable()">
								<p:confirm header="Inclusão de Atendimento para Paciente com estado Faltoso" icon="ui-icon-alert" message="Deseja realmente INCLUIR Atendimento para o Paciente com estado FALTOSO?"/>
							</p:commandButton>	
							
							<p:spacer width="5" rendered="#{agendamento.situacao == 'F' and pagesMB.permissaoGestor}"/>														
							
							<!--  -->
							
							<p:commandButton 
							icon="ui-icon-cancel"
							title="Cancelar Atendimento"
							oncomplete="dialog_cancelar_atendimento_wv.show()"
							update=":#{p:component('messages')}, 
							:#{p:component('panel_agendamento')},
							:#{p:component('dialog_cancelar_atendimento')}"
							rendered="#{pagesMB.permissaoAtendenteConsultorio and agendamento.situacao == 'T' and agendamentoMB.diaBloqueado == false}"
							widgetVar="bt_cancelar_atendimento_wv_#{agendamento.idAgendamento}"
							onclick="bt_cancelar_atendimento_wv_#{agendamento.idAgendamento}.disable()">
								<f:setPropertyActionListener target="#{atendimentoMB.atendimentoDTO}" value="#{atendimentoMB.buscarPorAgendamento(agendamento)}"/>
							</p:commandButton>	
							
							<p:spacer width="5" rendered="#{agendamento.situacao == 'T'}"/>	
							
							<p:commandButton action="#{atendimentoMB.reativarAtendimento(atendimentoMB.buscarPorAgendamento(agendamento))}"
							icon="ui-icon-arrowreturn-1-e"
							title="Reativar Atendimento"
							update=":#{p:component('messages')}, 
							:#{p:component('panel_agendamento')}"
							rendered="#{pagesMB.permissaoGestor and agendamento.situacao == 'G' and agendamentoMB.diaBloqueado == false}"
							widgetVar="bt_reativar_atendimento_wv_#{agendamento.idAgendamento}"
							onclick="bt_reativar_atendimento_wv_#{agendamento.idAgendamento}.disable()">
								<p:confirm header="Reativar Atendimento" icon="ui-icon-alert" message="Deseja realmente REATIVAR o Atendimento Cancelado?"/>
							</p:commandButton>	
							
							<p:spacer width="5" rendered="#{agendamento.situacao == 'G'}"/>																				
							
							<p:commandButton action="#{agendamentoMB.removerAgendamento(agendamento)}" 
							icon="ui-icon-closethick"
							title="Remover Agendamento"
							update=":#{p:component('messages')}, 
							:#{p:component('panel_agendamento')}"
							rendered="#{pagesMB.permissaoAdministrador and atendimentoMB.isAtendimentoParaAgendamento(agendamento.idAgendamento) == 'false' and agendamentoMB.diaBloqueado == false}"
							widgetVar="bt_remover_agendamento_wv_#{agendamento.idAgendamento}"
							onclick="bt_remover_agendamento_wv_#{agendamento.idAgendamento}.disable()">
								<p:confirm header="Cancelar Agendamento" icon="ui-icon-alert" message="Deseja realmente INATIVAR o Agendamento?"/>
							</p:commandButton>								
							</p:column>														
							
							<f:facet name="footer">
								<h:outputText value="Total de Agendamentos: #{agendamentoMB.agendamentosFiltrados.size()} | Vagas Disponíveis: #{agendamentoMB.getTotalAtendimentos()}" />
							
								<h:outputText rendered="#{pagesMB.igualDataAtual(agendamentoMB.dentistaAgendaSelecionadoDTO.dataAgenda)}"
								value=" | Total de Atendimentos: #{atendimentoMB.buscarPorData(agendamentoMB.dentistaAgendaSelecionadoDTO.dataAgenda, agendamentoMB.dentistaAgendaSelecionadoDTO.estabelecimentoDTO).size()}" />
							  
							</f:facet>																												
						</p:dataTable>
					</h:panelGrid>
				</p:fieldset>
				<h:panelGrid columns="2">		
				<h:panelGrid columns="2" rendered="#{agendamentoMB.dentistaAgendaSelecionadoDTO.idDentistaAgenda != null and agendamentoMB.agendamentosFiltrados.size() > 0}">
					<p:commandButton value="Enviar Email" icon="ui-icon-mail-closed" 
					oncomplete="dialog_msg_email_wv.show()"
					update=":#{p:component('messages')}"
					disabled="#{agendamentoMB.agendamentosFiltrados.size() == 0}"
					rendered="#{agendamentoMB.diaBloqueado == false  and pagesMB.permissaoAtendente}"
					title="Enviar Email a todos o clientes agendados"/>
					
					<p:commandButton value="Enviar Torpedo" icon="ui-icon-signal" 
					oncomplete="dialog_msg_torpedo_wv.show()"
					rendered="#{agendamentoMB.diaBloqueado == false and pagesMB.permissaoAtendente}"
					update=":#{p:component('dialog_msg_torpedo_pn')}"
					disabled="#{agendamentoMB.agendamentosFiltrados.size() == 0}"
					title="Enviar Torpedo a todos o clientes agendados"/>				
				</h:panelGrid>
				
				<h:panelGrid columns="2" >
					<p:commandButton value="Visualizar Agendamentos" icon="ui-icon-clock"
					action="visualizar-agendamento"/>
					
					<p:commandButton value="Visualizar Atendimentos" icon="ui-icon-calendar"
					action="visualizar-atendimento"/>	
								
				</h:panelGrid>
				</h:panelGrid>																							
			</h:panelGrid>
			</p:panel>
			<p:spacer height="80"/>




<!-- DIALOG - CANCELAR ATENDIMENTO -->	

			<p:dialog id="dialog_cancelar_atendimento" resizable="false" modal="true"
				widgetVar="dialog_cancelar_atendimento_wv" header="CANCELAR ATENDIMENTO"
				closeOnEscape="true" hideEffect="clip"
				showEffect="clip" width="900" closable="false">	
				
				<h:panelGrid id="panel_cancelar_atendimento" columns="1" cellpadding="5" width="100%">
					<p:fieldset legend="Dados do Atendimento">
						<h:panelGrid columns="2" cellpadding="5">
							<h:outputText value="Data do Atendimento: " />
							<h:outputText value="#{atendimentoMB.atendimentoDTO.agendamento.dentistaAgenda.dataAgenda}">
								<f:convertDateTime pattern="dd/MM/yyyy"/>
							</h:outputText>
							<h:outputText value="Horário do Atendimento: " />
							<h:outputText value="#{atendimentoMB.atendimentoDTO.agendamento.dentistaAgenda.intervaloTempo}" />
							<h:outputText value="Dentista: " />
							<h:outputText value="#{atendimentoMB.atendimentoDTO.agendamento.dentistaAgenda.dentista.nomeComCROFormatado}" />
							<h:outputText value="Código do Paciente: " />
							<h:outputText value="#{atendimentoMB.atendimentoDTO.agendamento.paciente.idPaciente}" />							
							<h:outputText value="Nome do Paciente: " />
							<h:outputText value="#{atendimentoMB.atendimentoDTO.agendamento.paciente.nomeCompleto}" />
							<h:outputText value="Telefone do paciente:" rendered="#{pagesMB.permissaoGestor}"/>
							<h:outputText value="#{atendimentoMB.atendimentoDTO.agendamento.paciente.telResidencial}" 
							rendered="#{pagesMB.permissaoGestor}"/>																												
						</h:panelGrid>
					</p:fieldset>
					
					<p:fieldset legend="Dados de Observação">
						<h:panelGrid id="pn_motivo_cancelamento_atendimento" columns="2" cellpadding="5">
							<p:outputLabel for="tx_cancelar_atendimento" value="Motivo de Cancelamento: " />
							<h:panelGrid columns="1">
								<p:inputTextarea id="tx_cancelar_atendimento"
								maxlength="300"
								cols="50"
								rows="8"
								autoResize="true"
								counter="display_tx_cancelar_atendimento"
								counterTemplate="{0} caracteres restantes."
								value="#{atendimentoMB.motivoCancelamento}">
									<p:ajax event="valueChange" update=":#{p:component('pn_motivo_cancelamento_atendimento')}"/>
								</p:inputTextarea>	
								<h:outputText id="display_tx_cancelar_atendimento" />	
							</h:panelGrid>
						</h:panelGrid>
					</p:fieldset>
												
					<h:panelGrid columns="2">
						<p:commandButton value="Cancelar Atendimento" icon="ui-icon-closethick"
						action="#{atendimentoMB.cancelarAtendimento()}"
						oncomplete="dialog_cancelar_atendimento_wv.hide()"
						update=":#{p:component('messages')}, :#{p:component('panel_agendamento')}"
						widgetVar="bt_cancelar_atendimento_dialog_wv"
						onclick="bt_cancelar_atendimento_dialog_wv.disable()">
							<p:confirm header="Confirmação de Cancelamento" icon="ui-icon-alert" message="Deseja realmente CANCELAR o Atendimento do Paciente?"/>
						</p:commandButton>	
						
					<p:commandButton icon="ui-icon-arrowrefresh-1-w"
					value="Voltar" immediate="true" onclick="dialog_cancelar_atendimento_wv.hide()"/>												
					</h:panelGrid>
				</h:panelGrid>
			</p:dialog>	

<!-- DIALOG - CANCELAR AGENDAMENTO -->	
	
			<p:dialog id="dialog_cancelar_agendamento" resizable="false" modal="true"
				widgetVar="dialog_cancelar_agendamento_wv" header="CANCELAR AGENDAMENTO"
				closeOnEscape="true" hideEffect="clip"
				showEffect="clip" width="900" closable="false">	
				
				<h:panelGrid id="panel_cancelar_agendamento" columns="1" cellpadding="5" width="100%">
					<p:fieldset legend="Dados do Agendamento">
						<h:panelGrid columns="2" cellpadding="5">
							<h:outputText value="Data do Agendamento: " />
							<h:outputText value="#{agendamentoMB.agendamentoDTO.dentistaAgenda.dataAgenda}">
								<f:convertDateTime pattern="dd/MM/yyyy"/>
							</h:outputText>
							<h:outputText value="Horário do Agendamento: " />
							<h:outputText value="#{agendamentoMB.agendamentoDTO.dentistaAgenda.intervaloTempo}" />
							<h:outputText value="Dentista: " />
							<h:outputText value="#{agendamentoMB.agendamentoDTO.dentistaAgenda.dentista.nomeComCROFormatado}" />
							<h:outputText value="Código do Paciente: " />
							<h:outputText value="#{agendamentoMB.agendamentoDTO.paciente.idPaciente}" />							
							<h:outputText value="Nome do Paciente: " />
							<h:outputText value="#{agendamentoMB.agendamentoDTO.paciente.nomeCompleto}" />
							<h:outputText value="Telefone do paciente:" />
							<h:outputText value="#{agendamentoMB.agendamentoDTO.paciente.telResidencial}" />																												
						</h:panelGrid>
					</p:fieldset>
					
					<p:fieldset legend="Dados de Observação">
						<h:panelGrid id="pn_motivo_cancelamento_agendamento" columns="2" cellpadding="5">
							<p:outputLabel for="tx_cancelar_agendamento" value="Motivo de Cancelamento: " />
							<h:panelGrid columns="1">
								<p:inputTextarea id="tx_cancelar_agendamento"
								maxlength="300"
								cols="50"
								rows="8"
								autoResize="true"
								counter="display_tx_cancelar_agendamento"
								counterTemplate="{0} caracteres restantes."
								value="#{agendamentoMB.motivoCancelamento}">
									<p:ajax event="valueChange" update=":#{p:component('pn_motivo_cancelamento_agendamento')}"/>
								</p:inputTextarea>	
								<h:outputText id="display_tx_cancelar_agendamento" />	
							</h:panelGrid>
						</h:panelGrid>
					</p:fieldset>							
					<h:panelGrid columns="2">
						<p:commandButton value="Cancelar Agendamento" icon="ui-icon-closethick"
						action="#{agendamentoMB.cancelarAgendamento()}"
						oncomplete="dialog_cancelar_agendamento_wv.hide()"
						update=":#{p:component('messages')}, :#{p:component('panel_agendamento')}"
						widgetVar="bt_cancelar_agendamento_dialog_wv"
						onclick="bt_cancelar_agendamento_dialog_wv.disable()">
							<p:confirm header="Confirmação de Cancelamento" icon="ui-icon-alert" message="Deseja realmente CANCELAR o Agendamento do Paciente?"/>
						</p:commandButton>	
						
					<p:commandButton icon="ui-icon-arrowrefresh-1-w"
					value="Voltar" immediate="true" onclick="dialog_cancelar_agendamento_wv.hide()"/>												
					</h:panelGrid>
				</h:panelGrid>
			</p:dialog>	
	
<!-- DIALOG - REMARCAÇÃO DO PACIENTE -->		
	
			<p:dialog id="dialog_remarcacao_paciente" resizable="false" modal="true"
				widgetVar="dialog_remarcacao_paciente_wv" header="REMARCAÇÃO DO PACIENTE"
				closeOnEscape="true" hideEffect="clip"
				showEffect="clip" width="900" closable="false">	

				 <h:panelGrid id="panel_remarcacao_agendamento" columns="1" cellpadding="5" width="100%" rendered="#{agendamentoMB.reagendamento}">
					
					<p:fieldset legend="Filtro de Busca" toggleable="true"
					rendered="#{agendamentoMB.dentistaAgendaReagendamentoDTO.idDentistaAgenda == null}">
						<h:panelGrid columns="2">
						
							<h:outputLabel for="agenda_dentista_estabelecimento_remarcacao" value="Estabelecimento: " />							
							<h:selectOneMenu id="agenda_dentista_estabelecimento_remarcacao"
								value="#{dentistaAgendaMB.estabelecimentoFiltroDTO}"
								converter="estabelecimentoConverter"
								disabled="#{pagesMB.permissaoGestor ? 'false' : 'true'}">								
	
								<f:selectItem itemLabel="Escolha uma opção"
									noSelectionOption="true" />
	
								<f:selectItems value="#{estabelecimentoMB.estabelecimentos}" 
									var="estabelecimento" itemLabel="#{estabelecimento.nomeEstabelecimentoFormatado}" 
									itemValue="#{estabelecimento}">
								</f:selectItems>
									
								<p:ajax event="valueChange" update=":#{p:component('panel_remarcacao_agendamento')}"></p:ajax>
	
							</h:selectOneMenu>					
							
							<h:outputText value="Data: " />
							<p:calendar locale="pt" value="#{dentistaAgendaMB.dataFiltro}"
							mindate="#{agendamentoMB.minDataParaReagendamento}" pattern="dd/MM/yyyy">
								<p:ajax event="dateSelect" update=":#{p:component('panel_remarcacao_agendamento')}"/>
								<p:ajax event="valueChange" update=":#{p:component('panel_remarcacao_agendamento')}"/>
							</p:calendar>					
						</h:panelGrid>
						<br />
						<p:dataTable id="tabela_dentista_agenda_remarcacao"
						rendered="#{dentistaAgendaMB.dataFiltro != null and dentistaAgendaMB.estabelecimentoFiltroDTO.idEstabelecimento != null}"
						value="#{dentistaAgendaMB.dentistaAgendasFiltrados}" var="agenda"
						paginator="#{dentistaAgendaMB.dentistaAgendasFiltrados.size() > pagesMB.atributoOperacionalSelecionado.numeroLinhaTabela ? 'true' : 'false'}" rows="#{pagesMB.atributoOperacionalSelecionado.numeroLinhaTabela}"
						paginatorPosition="bottom"
						emptyMessage="Nenhum dado encontrado...">
							<f:facet name="header">
									<h:outputText value="TABELA DE AGENDAS DE DENTISTAS PARA O DIA: "/>
									<h:outputText value="#{dentistaAgendaMB.dataFiltro}">
										<f:convertDateTime pattern="dd/MM/yyyy"/>
									</h:outputText>	
							</f:facet>
							
							<p:column width="5%">
								<f:facet name="header">Ordem</f:facet>
								#{dentistaAgendaMB.dentistaAgendasFiltrados.indexOf(agenda) + 1}
							</p:column>
	
							<p:column width="10%" style="text-align: center">
								<f:facet name="header">CRO</f:facet>
								#{agenda.dentista.croFormatado}
							</p:column>	
								
							<p:column width="20%" style="text-align: center">
								<f:facet name="header">Dentista</f:facet>
								#{agenda.dentista.nomeCompleto}
							</p:column>															
								
							<p:column width="15%">
								<f:facet name="header">Data</f:facet>
								<h:outputText value="#{agenda.dataAgenda}">
									<f:convertDateTime pattern="dd/MM/yyyy"/>
								</h:outputText>
							</p:column>	
								
							<p:column width="50%" style="text-align: center">
								<f:facet name="header">Intervalo Horário</f:facet>
								#{agenda.intervaloTempo}
							</p:column>	
							
							<p:column >
								<p:commandButton action="#{agendamentoMB.selecionarDentistaAgendaReagendamento(agenda)}" 
								icon="ui-icon-flag"
								title="Selecionar Agenda de Dentista"
								update=":#{p:component('messages')}, 
								:#{p:component('panel_remarcacao_agendamento')}"/>								
							</p:column>												
						</p:dataTable>					
					</p:fieldset>
					
					<p:fieldset legend="Dados do Reagendamento"
					rendered="#{agendamentoMB.dentistaAgendaReagendamentoDTO.idDentistaAgenda != null}">
						<h:panelGrid columns="2" cellpadding="5">
							<h:outputText value="Data do Reagendamento: " />
							<h:outputText value="#{agendamentoMB.dentistaAgendaReagendamentoDTO.dataAgenda}">
								<f:convertDateTime pattern="dd/MM/yyyy"/>
							</h:outputText>
							<h:outputText value="Horário do Reagendamento: " />
							<h:outputText value="#{agendamentoMB.dentistaAgendaReagendamentoDTO.intervaloTempo}" />						
							<h:outputText value="Nome do Dentista: " />
							<h:outputText value="#{agendamentoMB.dentistaAgendaReagendamentoDTO.dentista.nomeCompleto}" />
							<h:outputText value="CRO: " />
							<h:outputText value="#{agendamentoMB.dentistaAgendaReagendamentoDTO.dentista.croFormatado}" />	
							<h:outputText value="Vagas Disponíveis: " />
							<h:outputText value="#{agendamentoMB.vagasReagendamento}" rendered="#{agendamentoMB.vagasReagendamento == 0}" 
							title="Não há vaga disponível para agendar o Paciente, favor selecionar outra Agenda de Dentista."
							style="cursor: help; color: #F00; font-weight: bold;"/>
							<h:outputText value="#{agendamentoMB.vagasReagendamento}" rendered="#{agendamentoMB.vagasReagendamento > 0}"/>										
							<p:commandButton icon="ui-icon-closethick" title="Remover seleção da Agenda do Dentista" 
							action="#{agendamentoMB.removerSelecaoDentistaAgendaReagendamento()}" update=":#{p:component('panel_remarcacao_agendamento')}"/>
						</h:panelGrid>
					</p:fieldset>	

					<h:panelGrid columns="3" >
						<p:commandButton value="Reagendar" icon="ui-icon-clock"
						action="#{agendamentoMB.reagendarPaciente()}"
						oncomplete="dialog_remarcacao_paciente_wv.hide()"
						update=":#{p:component('messages')}"
						disabled="#{agendamentoMB.dentistaAgendaReagendamentoDTO.idDentistaAgenda == null or agendamentoMB.vagasReagendamento == 0}"
						widgetVar="bt_reagendar_wv"
						onclick="bt_reagendar_wv.disable()">
							<f:actionListener binding="#{dentistaAgendaMB.limparMB()}"/>
							<f:actionListener binding="#{estabelecimentoMB.limparMB()}"/>
						</p:commandButton>
						
						<p:commandButton value="Cancelar Reagendamento" icon="ui-icon-closethick"
						action="#{agendamentoMB.cancelarReagendamento(false)}"
						oncomplete="dialog_remarcacao_paciente_wv.hide()"
						update=":#{p:component('messages')}"
						widgetVar="bt_cancelar_reagendamento_wv"
						onclick="bt_cancelar_reagendamento_wv.disable()">
							<p:confirm header="Cancelar Reagendamento" icon="ui-icon-alert" message="Deseja Realmente CANCELAR o Reagendamento do Paciente?"/>
						</p:commandButton>							
						
						<p:commandButton value="Paciente Discorda" icon="ui-icon-person"
						action="#{agendamentoMB.cancelarReagendamento(true)}" 
						title="O Paciente não quer ser Reagendado!"
						oncomplete="dialog_remarcacao_paciente_wv.hide()"
						update=":#{p:component('messages')}"
						widgetVar="bt_paciente_discorda_wv"
						onclick="bt_paciente_discorda_wv.disable()">
							<p:confirm header="Cancelar Reagendamento" icon="ui-icon-alert" message="O Paciente realmente DISCORDA de ser reagendado?"/>
						</p:commandButton>													
									
					</h:panelGrid>
																						
				</h:panelGrid>		
			</p:dialog>
	
<!-- DIALOG - OBS PACIENTE -->	
			
			<p:dialog id="dialog_obs_paciente" resizable="false" modal="true"
				widgetVar="dialog_obs_paciente_wv" header="OBSERVAÇÕES DO PACIENTE"
				closeOnEscape="true" hideEffect="clip"
				showEffect="clip" width="900">
				
				
				<h:panelGrid id="pn_obs_paciente" columns="1" cellpadding="5">
					<p:fieldset legend="Dados do paciente">
						<h:panelGrid columns="1">
							<h:outputText value="Código: #{obsPacienteMB.pacienteDTO.idPaciente}" />
							<h:outputText value="Nome: #{obsPacienteMB.pacienteDTO.nomeCompleto}" />
							<h:outputText value="Telefone: #{obsPacienteMB.pacienteDTO.telResidencial}" />
						</h:panelGrid>
					</p:fieldset>
					
					<p:fieldset legend="Observações">

						<h:panelGrid columns="2" cellpadding="2" id="pn_incluir_obs_paciente">
							<h:outputText value="Tipo de Observação: " />
							<h:outputText value="#{obsPacienteMB.tipoObs.tipoObs}" />										
							<p:outputLabel for="tx_obs_paciente" value="Observação: " />
							<h:panelGrid columns="1">
								<p:inputTextarea id="tx_obs_paciente"
								maxlength="450"
								cols="50"
								rows="8"
								autoResize="true"
								counter="display_tx_obs_paciente"
								counterTemplate="{0} caracteres restantes."
								value="#{obsPacienteMB.obsPacienteDTO.obs}">
									<p:ajax event="valueChange" update=":#{p:component('pn_incluir_obs_paciente')}"/>
								</p:inputTextarea>	
								<h:outputText id="display_tx_obs_paciente" />	
							</h:panelGrid>
							
							<h:panelGrid columns="2">			
								<p:commandButton action="#{obsPacienteMB.salvar()}" icon="ui-icon-plusthick"	
								disabled="#{obsPacienteMB.obsPacienteDTO.obs.length() == 0}"
								value="Incluir Observação" title="Inclui uma observação para o Paciente." update="messages, :#{p:component('pn_obs_paciente')}" />
							</h:panelGrid>																						
						</h:panelGrid>

						<p:dataTable id="tabela_obs_paciente"
						value="#{obsPacienteMB.buscarObsPacientesPeloTipoEPaciente()}" var="obsPaciente"
						paginator="#{dentistaAgendaMB.dentistaAgendasFiltrados.size() > pagesMB.atributoOperacionalSelecionado.numeroLinhaTabela ? 'true' : 'false'}" rows="#{pagesMB.atributoOperacionalSelecionado.numeroLinhaTabela}"
						emptyMessage="Nenhum dado encontrado...">
							
							<f:facet name="header">
								TABELA DO OBSERVAÇÕES DO PACIENTE
							</f:facet>
							
							<p:column>
								<f:facet name="header">Ordem</f:facet>
								#{obsPacienteMB.buscarObsPacientesPeloTipoEPaciente().indexOf(obsPaciente) + 1}
							</p:column>
							
							<p:column>
								<f:facet name="header">Data</f:facet>
								
								<h:outputText value="#{obsPaciente.data}">
									<f:convertDateTime pattern="dd/MM/yyyy"/>
								</h:outputText>
							</p:column>
							
							<p:column>
								<f:facet name="header">Observação</f:facet>
								#{obsPaciente.obs}
							</p:column>
							
							<p:column>
								<f:facet name="header">Tipo</f:facet>
								#{obsPaciente.tipo.tipoObs}
							</p:column>
							
							<p:column>
								<f:facet name="header"> 
									<h:outputText value="Responsável" 
									title="Funcionário responsável pelo cadastro da 'Informação de Observação'"
									style="cursor: help"/>
								</f:facet>
								<h:outputText value="#{funcionarioMB.buscarPeloIdUsuario(obsPaciente.usuarioDTO.idUsuario).nome}" 
								title="#{funcionarioMB.buscarPeloIdUsuario(obsPaciente.usuarioDTO.idUsuario).nomeCompleto} / #{funcionarioMB.buscarPeloIdUsuario(obsPaciente.usuarioDTO.idUsuario).cargo.nomeCargo}"
								style="cursor: help; color: gray;"/>
							</p:column>							
							
							<p:column>
								<p:commandButton 
								icon="ui-icon-trash"
								rendered="#{pagesMB.permissaoAdministrador}"
								action="#{obsPacienteMB.removerObsPaciente(obsPaciente)}"
								update=":#{p:component('messages')}, :#{p:component('pn_obs_paciente')}"
								title="Remover Observação">
								</p:commandButton>
							</p:column>	
							
							<f:facet name="footer">
								Total de Observações: 
								#{obsPacienteMB.buscarObsPacientesPeloTipoEPaciente().size()}
							</f:facet>																																			
						</p:dataTable>									
					</p:fieldset>
					
					<p:commandButton icon="ui-icon-arrowrefresh-1-w"
					value="Voltar" immediate="true" onclick="dialog_obs_paciente_wv.hide()"/>					
				</h:panelGrid>
			</p:dialog>	

<!-- DIALOG - MSG TORPEDO -->
			
			<p:dialog id="dialog_msg_torpedo" resizable="false" modal="true" 
			widgetVar="dialog_msg_torpedo_wv" 
			header="SELECIONAR MENSAGEM DE TORPEDO"
			closeOnEscape="true" hideEffect="drop"
			width="800"
			showEffect="drop" >
			<h:panelGrid columns="1" id="dialog_msg_torpedo_pn" width="100%">
	 			
			<p:fieldset legend="Dados do Agendamento" toggleable="true">					
						<h:panelGrid columns="2" cellspacing="5">					
							<h:outputText value="Data: " />
							<h:outputText value="#{agendamentoMB.dentistaAgendaSelecionadoDTO.dataAgenda}">
								<f:convertDateTime pattern="dd/MM/yyyy"/>
							</h:outputText>
							<h:outputText value="Horário: " />
							<h:outputText value="#{agendamentoMB.dentistaAgendaSelecionadoDTO.intervaloTempo}" />
							<h:outputText value="Dentista: " />
							<h:outputText value="#{agendamentoMB.dentistaAgendaSelecionadoDTO.dentista.nomeCompleto}" />									
							<h:outputText value="CRO:  " />
							<h:outputText value="#{agendamentoMB.dentistaAgendaSelecionadoDTO.dentista.croFormatado}" />																																																							
						</h:panelGrid>												
				</p:fieldset>	 			
	 			<br />
	 			<p:fieldset legend="Seleção de Mensagem"
	 			rendered="#{agendamentoMB.msgPreTorpedoSelecionadoDTO.idMsgPreTorpedo == null}">
					<p:dataTable value="#{msgPreTorpedoMB.buscarMsgPreTorpedos()}" var="msgTorpedo"
					paginator="#{msgPreTorpedoMB.buscarMsgPreTorpedos().size() > pagesMB.atributoOperacionalSelecionado.numeroLinhaTabela ? 'true' : 'false'}" rows="#{pagesMB.atributoOperacionalSelecionado.numeroLinhaTabela}"
						emptyMessage="Nenhuma Mensagem de Torpedo cadastrada...">
							<f:facet name="header">
								<h:outputText value="TABELA DE MENSAGENS DE TORPEDO"/>
							</f:facet>
							<p:column style="text-align: center">
								<f:facet name="header">Descrição</f:facet>
								#{msgTorpedo.descricao}
							</p:column>
							<p:column style="text-align: center">
								<f:facet name="header">Título</f:facet>
								#{msgTorpedo.titulo}
							</p:column>
							<p:column>
								<p:commandButton value="Selecionar"
									icon="ui-icon-flag"
									action="#{agendamentoMB.selecionarMensagemTorpedo(msgTorpedo)}"
									update=":#{p:component('dialog_msg_torpedo_pn')}">
								</p:commandButton>
							</p:column>														
						</p:dataTable>					 			
	 			</p:fieldset>
	 			<br />
	 			<p:fieldset legend="Mensagem Selecionada" 
	 			rendered="#{agendamentoMB.msgPreTorpedoSelecionadoDTO.idMsgPreTorpedo != null}">
	 				<h:panelGrid columns="2">
						<h:outputText value="Descrição: " />
						<h:outputText value="#{agendamentoMB.msgPreTorpedoSelecionadoDTO.descricao}" />
						<h:outputText value="Título: " />
						<h:outputText value="#{agendamentoMB.msgPreTorpedoSelecionadoDTO.titulo}" />									
						<h:outputText value="Mensagem: " />
						<h:outputText value="#{agendamentoMB.msgPreTorpedoSelecionadoDTO.msg}" /> 
						<p:commandButton icon="ui-icon-closethick" title="Remover seleção de Mensagem de Torpedo" 
						action="#{agendamentoMB.removerSelecaoMensagemTorpedo()}" update=":#{p:component('dialog_msg_torpedo_pn')}"/>
					</h:panelGrid>									
	 			</p:fieldset>
	 			<br />				
				<h:panelGrid columns="2">
				<p:commandButton value="Enviar Torpedo"
				rendered="#{agendamentoMB.msgPreTorpedoSelecionadoDTO.idMsgPreTorpedo != null}" 
				action="#{agendamentoMB.enviarTorpedoAgendamento()}"
				icon="ui-icon-signal-diag"
				oncomplete="dialog_msg_torpedo_wv.hide()"
				update=":#{p:component('messages')}"
				widgetVar="bt_enviar_torpedo_wv"
				onclick="bt_enviar_torpedo_wv.disable()"/>
									
				<p:commandButton value="Voltar" icon="ui-icon-arrowrefresh-1-w"
				onclick="dialog_msg_torpedo_wv.hide()"/>
				</h:panelGrid>
				 
			</h:panelGrid>
			</p:dialog>												

<!-- DIALOG - PACIENTE ATUALIZAÇÃO -->
						
			<p:dialog id="dialog_paciente_atualizacao" resizable="false" modal="true" 
			widgetVar="dialog_paciente_atualizacao_wv" 
			header="ATUALIZAR DADOS DE COMUNICAÇÃO"
			closeOnEscape="true" hideEffect="drop"
			showEffect="drop" >
				<p:fieldset legend="Dados do paciente">
					<h:panelGrid columns="2" cellpadding="5">
						<h:outputText value="ID: " />
						<h:outputText value="#{pacienteMB.pacienteDTO.idPaciente}" />
						<h:outputText value="Nome: " />
						<h:outputText value="#{pacienteMB.pacienteDTO.nomeCompleto}" />
						<h:outputText value="CPF: " />
						<h:outputText value="#{pacienteMB.pacienteDTO.cpf}" />	
						<h:outputText value="Estabelecimento: " />	
						<h:outputText value="#{pacienteMB.pacienteDTO.estabelecimentoDTO.nomeEstabelecimentoFormatado}" />						
					</h:panelGrid>
				</p:fieldset>
				<br />
				<p:fieldset legend="Dados de Comunicação">
					<h:panelGrid id="paciente_atualizacao_pn" columns="2" cellpadding="5">
						<h:outputText value="Email: " />
						<h:outputText value="#{pacienteMB.pacienteDTO.email}" />
						
						<h:outputLabel for="paciente_telefone_alt" value="Telefone: *" />
						<p:inputMask id="paciente_telefone_alt" mask="(99) 99999-9999" size="15"
							value="#{pacienteMB.pacienteDTO.telResidencial}">
						</p:inputMask>
								
						<h:outputLabel for="paciente_celular_01_alt" value="Celular (Principal): *" />
						<h:panelGrid columns="2">
							<h:selectOneMenu id="paciente_cel01_op_alt"
								value="#{pacienteMB.pacienteDTO.operadoraCel01}"
								converter="operadoraConverter">								

								<f:selectItem itemLabel="Escolha uma opção"
									noSelectionOption="true" />

								<f:selectItems value="#{operadoraMB.operadorasFiltrados}" var="operadora"
									itemLabel="#{operadora.nomeOperadora}" itemValue="#{operadora}">
								</f:selectItems>
								
								<p:ajax event="valueChange" update=":#{p:component('paciente_cel01_op_alt')}"></p:ajax>

							</h:selectOneMenu>							
							<p:inputMask id="paciente_celular_01_alt" mask="(99) 99999-9999" size="15"
								value="#{pacienteMB.pacienteDTO.cel01}">
								</p:inputMask>
						</h:panelGrid>	
							
						<h:outputLabel for="paciente_celular_02_alt" value="Celular (Secundário 01): " />
						<h:panelGrid columns="2">
							<h:selectOneMenu id="paciente_cel02_op_alt"
								value="#{pacienteMB.pacienteDTO.operadoraCel02}"
								converter="operadoraConverter">								

								<f:selectItem itemLabel="Escolha uma opção"
									noSelectionOption="true" />

								<f:selectItems value="#{operadoraMB.operadorasFiltrados}" var="operadora"
									itemLabel="#{operadora.nomeOperadora}" itemValue="#{operadora}">
								</f:selectItems>
								
								<p:ajax event="valueChange" update=":#{p:component('paciente_cel02_op_alt')}"></p:ajax>

							</h:selectOneMenu>							
							<p:inputMask id="paciente_celular_02_alt" mask="(99) 99999-9999" size="15"
								value="#{pacienteMB.pacienteDTO.cel02}">
								</p:inputMask>
						</h:panelGrid>
							
						<h:outputLabel for="paciente_celular_03_alt" value="Celular (Secundário 02): " />
						<h:panelGrid columns="2">
							<h:selectOneMenu id="paciente_cel03_op_alt"
								value="#{pacienteMB.pacienteDTO.operadoraCel03}"
								converter="operadoraConverter">								

								<f:selectItem itemLabel="Escolha uma opção"
									noSelectionOption="true" />

								<f:selectItems value="#{operadoraMB.operadorasFiltrados}" var="operadora"
									itemLabel="#{operadora.nomeOperadora}" itemValue="#{operadora}">
								</f:selectItems>
								
								<p:ajax event="valueChange" update=":#{p:component('paciente_cel03_op_alt')}"></p:ajax>

							</h:selectOneMenu>							
							<p:inputMask id="paciente_celular_03_alt" mask="(99) 99999-9999" size="15"
								value="#{pacienteMB.pacienteDTO.cel03}">
								</p:inputMask>		
						</h:panelGrid>				
					</h:panelGrid>					
				</p:fieldset>
				<br />
				<h:panelGrid columns="2" cellpadding="5">
					<p:commandButton action="#{pacienteMB.alterar()}"
					icon="ui-icon-refresh"
					value="Atualizar" update=":#{p:component('messages')},
					:#{p:component('tabela_paciente')}, :#{p:component('paciente_atualizacao_pn')}" 
					oncomplete="dialog_paciente_atualizacao_wv.hide()"/>

					<p:commandButton value="Voltar" icon="ui-icon-arrowrefresh-1-w"
					onclick="dialog_paciente_atualizacao_wv.hide()"/>
				</h:panelGrid>
			</p:dialog>	

<!-- DIALOG DE CONFIRMAÇÃO-->
			
			<p:confirmDialog global="true" showEffect="drop" hideEffect="drop">
				<p:commandButton value="Sim" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check"/>
				<p:commandButton value="Não" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close"/>	
			</p:confirmDialog>										
		</h:form>
	</ui:define>
</ui:composition>
</html>